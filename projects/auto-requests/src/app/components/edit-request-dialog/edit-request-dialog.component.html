<div class="add-request-container">

  <div class="side p-4">
    <div class="label">
      <!--<div class="subtitle">Заявки на автостранспорт</div>-->
      <div class="title">Заявка #{{(selectedRequest$ | async)?.id}}</div>
    </div>

    <div class="d-flex flex-column justify-content-start flex-grow-1 pt-1 mt-4">

      <!-- Start: Транспорт -->
      <app-transport-typeahead [transport]="transport$ | async"
                               (select)="selectTransport($event)">
      </app-transport-typeahead>
      <!-- End: Транспорт -->

      <!-- Start: Водитель -->
      <app-driver-typeahead class="mt-3"
                            [drivers]="drivers$ | async"
                            (select)="selectDriver($event)">
      </app-driver-typeahead>
      <!-- End: Водитель -->

      <!-- Start: Статус заявки -->
      <div [formGroup]="requestForm">
        <mat-form-field appearance="fill" class="w-100 mt-3 pt-1" floatLabel="always">
          <mat-label>Статус заявки</mat-label>
          <mat-icon matPrefix
                    class="mr-3"
                    [ngStyle]="{'color': requestForm.controls.status.value.color}">
            {{requestForm.controls.status.value.icon}}
          </mat-icon>
          <mat-select formControlName="status" [compareWith]="statusCompare">
            <mat-select-trigger>
              <!--{{selectedRequest.status.title}}-->
              {{requestForm.controls.status.value.title}}
            </mat-select-trigger>
            <mat-option *ngFor="let status of (statuses$ | async)" [value]="status">
              <mat-icon class="mr-3" [ngStyle]="{'color': status.color}">{{status.icon}}</mat-icon>
              {{status.title}}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <!-- End: Статус заявки -->
    </div>

    <!--<div class="comment">от {{selectedRequest.dateCreatedD | date:'dd MMMM yyyy, hh:mm'}}</div>-->
    <button mat-raised-button
            color="primary"
            class="w-100 pt-2 pb-2"
            [disabled]="(isLoading$ | async) || (requestForm.dirty && requestForm.invalid) || selectedRequest.route.length < 2 || requestForm.pristine"
            (click)="editRequest()">
      Сохранить изменения
    </button>

  </div>

  <div class="content p-4">
    <form class="row w-100" [formGroup]="requestForm">

      <div class="col-6 h-100 d-flex flex-column justify-content-between">

        <caption class="w-100 mb-3">Детали поездки</caption>

        <!-- Start: Инициатор -->
        <mat-form-field appearance="fill" class="w-100 mb-3 pr-3" floatLabel="always" *ngIf="selectedRequest.initiator">
          <mat-label>Инициатор</mat-label>
          <input matInput formControlName="initiator" readonly="true">
          <mat-hint>{{selectedRequest.initiator?.position}}</mat-hint>
        </mat-form-field>
        <!-- End: Инициатор -->

        <!-- Start: Заказчик -->
        <mat-form-field appearance="fill" class="w-100 pr-3" floatLabel="always">
          <mat-label>Заказчик</mat-label>
          <input matInput formControlName="user" readonly="true">
          <mat-hint>{{selectedRequest.user.position}}</mat-hint>
        </mat-form-field>
        <!-- End: Заказчик -->

        <!-- Start: Дата поездки -->
        <mat-form-field appearance="fill" class="w-100 mt-3 pr-3" floatLabel="always">
          <mat-label>Дата поездки</mat-label>
          <input matInput formControlName="date" [min]="(date$ | async)" [matDatepicker]="picker">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
        <!-- End: Дата поездки -->

        <div class="row pr-3">
          <div class="col">
            <!-- Start: Время начала поездки -->
            <mat-form-field appearance="fill" class="w-100 mt-3" floatLabel="always">
              <mat-label>Отправление</mat-label>
              <input matInput type="time" formControlName="startTime">
            </mat-form-field>
            <!-- End: Время начала поездки -->
          </div>
          <div class="col-auto d-flex flex-column justify-content-center align-items-center">&mdash;</div>
          <div class="col">
            <!-- Start: Время окончания поездки -->
            <mat-form-field appearance="fill" class="w-100 mt-3" floatLabel="always">
              <mat-label>Прибытие</mat-label>
              <input matInput type="time" formControlName="endTime">
            </mat-form-field>
            <!-- End: Время окончания поездки -->
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <!-- Start: О поездке -->
            <mat-form-field appearance="fill" class="w-100 mt-3 pr-3" floatLabel="always">
              <mat-label>О поездке</mat-label>
              <textarea matInput rows="2" formControlName="description"></textarea>
              <mat-hint align="start">Цель поездки, кол-во пассажиров и т.д.</mat-hint>
            </mat-form-field>
            <!-- End: О поездке-->
          </div>
        </div>

      </div>

      <div class="col-6 route h-100 d-flex flex-column">
        <div class="pl-3 pt-1">
          <caption class="d-block w-100 mb-3">Маршрут поездки</caption>
          <app-route-typeahead [routes]="routes$ | async" (select)="selectRoute($event)"></app-route-typeahead>
        </div>
        <div class="d-flex flex-grow-1 pl-3 pt-4">
          <app-route-path [routes]="selectedRequest.route"
                          [extended]="true"
                          (remove)="removeRoute($event)">
          </app-route-path>
        </div>
      </div>
    </form>
  </div>
</div>

